<?php
namespace OGAMBundle\Repository\Website;

use Doctrine\ORM\Query\ResultSetMapping;

/**
 * RoleRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class RoleRepository extends \Doctrine\ORM\EntityRepository {

	/**
	 * Count the number of users of a role.
	 *
	 * @param String $roleCode
	 * @return Integer
	 */
	public function userCount($roleCode) {

		$qm = $this->getEntityManager();

		$rsm = new ResultSetMapping();
		$rsm->addScalarResult('count', 'count');

		$query = $qm->createNativeQuery('SELECT count(*) FROM website.role_to_user WHERE role_code = ?', $rsm);
		$query->setParameter(1, $roleCode);

		return $query->getSingleScalarResult();
	}
}
