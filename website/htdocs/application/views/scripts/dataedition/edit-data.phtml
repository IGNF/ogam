<?php
/**
 * View for the creation of a new data.
 * @package views
 */
?>


<h1>
<?php
if ($this->mode == 'ADD') {
	echo 'Add '.$this->tableFormat->label;
} else {
	echo 'Edit '.$this->tableFormat->label;
}
?>
</h1>


<!-- Rappel des infos sur les tables parentes -->
<!-- Lien pour l'édition des tables parents -->
<fieldset>
<legend>Parents summary</legend>
<?php
$ancestors = array_reverse($this->ancestors);
foreach ($ancestors as $ancestor) {
	echo $this->generateEditLink($ancestor)."<br/>";
}

?>
</fieldset>

<div class="select-dataset-form">

<!-- Affichage du formulaire d'édition -->
<!--  Les élements faisant partie de la clé sont grisés -->
<!--  Les autres valeurs sont éditables -->
<fieldset>
<legend><?= $this->tableFormat->label; ?></legend>
<?= $this->form ?>
</fieldset>



<!-- Affichage les tables enfant (uniquement les valeurs de la clé) -->
<!-- Lien vers l'édition d'un enfant existant -->
<!-- Lien pour l'ajout d'un nouvel enfant -->
<?php
if (!empty($this->children)) {
?>
<fieldset>
<legend>Children summary</legend>
<?php
	// Iterate though the child tables
	foreach ($this->children as $childFormat => $childrenLines) {

		echo "<fieldset><legend>".$this->childrenTableLabels[$childFormat]."</legend>";

		// Add the edit links for each child of the current item
		foreach ($childrenLines as $child) {
			echo $this->generateEditLink($child)."<br/>";
		}

		// Add link to a new child
		$data = clone $this->data;
		$data->tableFormat->format = $childFormat;
		echo $this->generateAddLink($data, $this->childrenTableLabels[$childFormat])."<br/>";

		echo "</fieldset>";
	}
?>
</fieldset>
<?php } ?>



</div>


<div class="message">
<?= $this->message ?>
</div>