<?php
/**
 * View for the creation of a new data.
 * @package views
 */
?>


<h1>
<?php
if ($this->mode == 'ADD') {
	echo 'Add '.$this->tableFormat->format;
} else {
	echo 'Edit '.$this->tableFormat->format;
}
?>
</h1>


<!-- Rappel des infos sur les tables parentes -->
<!-- Lien pour l'édition des tables parents -->
<fieldset>
<legend>Parents summary</legend>
<?php
$ancestors = array_reverse($this->ancestors);
foreach ($ancestors as $ancestor) {
	echo $this->generateEditLink($ancestor)."<br/>";
}

?>
</fieldset>

<div class="select-dataset-form">

<!-- Affichage du formulaire d'édition -->
<!--  Les élements faisant partie de la clé sont grisés -->
<!--  Les autres valeurs sont éditables -->
<fieldset>
<legend><?= $this->tableFormat->format; ?></legend>
<?= $this->form ?>
</fieldset>



<!-- Affichage les tables enfant (uniquement les valeurs de la clé) -->
<!-- Lien vers l'édition d'un enfant existant -->
<!-- Lien pour l'ajout d'un nouvel enfant -->
<!-- Rappel des infos sur les tables parentes -->
<!-- Lien pour l'édition des tables parents -->
<?php
if (!empty($this->children)) {
?>
<fieldset>
<legend>Children summary</legend>
<?php
	// Iterate though the child tables
	foreach ($this->children as $childFormat => $childrenLines) {
		echo "<fieldset><legend>".$childFormat."</legend>";

		// Add the edit links for each child of the current item
		foreach ($childrenLines as $child) {
			echo $this->generateEditLink($child)."<br/>";
		}

		// Add link to a new child
		$urlArray = array('controller' => 'dataedition', 'action' => 'show-add-data');
		$urlArray['FORMAT'] = $childFormat;
		foreach ($this->data->infoFields as $tableField) {
			$urlArray[$tableField->data] = $tableField->value;
		}
		echo ' (+) <a href="'.$this->url($urlArray, null, true).'">Add '.$childFormat.'</a><br>';

		echo "</fieldset>";
	}
?>
</fieldset>
<?php } ?>


<!-- Sur chaque lien, alerte javascript proposant la sauvegarde des modifs -->

</div>


<div class="message">
<?= $this->message ?>
</div>