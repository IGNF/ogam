MAP

#
# Start of OGAM map file
#
NAME OGAM_MAPSERVER
STATUS ON
SIZE 600 400
SYMBOLSET "C:/workspace/OGAM/Mapserv/data/fonts/symbols.sym" 

EXTENT 2460853 1070607 5537352 5031904

UNITS meters
SHAPEPATH "C:/workspace/OGAM/Mapserv/data/"
IMAGECOLOR 255 255 255
FONTSET "C:/workspace/OGAM/Mapserv/data/fonts/fonts.txt"

CONFIG  "MS_ERRORFILE" "C:/workspace/OGAM/website/htdocs/logs/mapserver_ogam.log"
DEBUG 5

#
# Start of web interface definition
#
WEB
   LOG "C:/workspace/OGAM/website/htdocs/logs/mapserver_ogam.log"
   METADATA
   
		WFS_TITLE   					"OGAM MapServer"  
		WFS_SRS     					"EPSG:3035"
		WFS_ABSTRACT   					"OGAM Data"  
		WFS_MAXFEATURES    				"10"
		WFS_ONLINERESOURCE 				"http://localhost/cgi-bin/mapserv.exe?map=C:/workspace/OGAM/Mapserv/ogam.map&"

		WMS_TITLE 						"OGAM MapServer" 
		WMS_ABSTRACT 					"OGAM Mapserver"
		WMS_ACCESSCONSTRAINTS 			"none"
		WMS_ONLINERESOURCE 				"http://localhost/cgi-bin/mapserv.exe?map=C:/workspace/OGAM/Mapserv/ogam.map&"
		WMS_SRS    						"EPSG:3035"
      
      	"wcs_label"                    "OGAM MapServer"
		"wcs_description"              "OGAM MapServer"
		"wcs_onlineresource"           "http://localhost/ogam/" 
		"wcs_fees"                     "none"
		"wcs_accessconstraints"        "none"
		"wcs_keywordlist"              "wcs,test"
		"wcs_metadatalink_type"        "TC211"
		"wcs_metadatalink_format"      "text/plain"
    END
END

PROJECTION
  "init=epsg:3035"
END

SCALEBAR
	UNITS kilometers	
	INTERVALS 1
	SIZE 100 2
	LABEL
  		COLOR  0 0 0
  		OUTLINECOLOR 255 255 255
    END
END

OUTPUTFORMAT
  NAME PNG
  DRIVER "GD/PNG"
  MIMETYPE "image/png"
  IMAGEMODE RGBA
  FORMATOPTION  INTERLACE=OFF
  TRANSPARENT ON
END

OUTPUTFORMAT
  NAME JPEG
  DRIVER "GD/JPEG"
  MIMETYPE "image/jpeg"
  IMAGEMODE RGB
  EXTENSION "jpg"
  FORMATOPTION QUALITY=80 
END

#
# Start of legend
#
LEGEND
  KEYSIZE 18 12
  LABEL
    FONT arial_win
    TYPE TRUETYPE 
    ENCODING UTF-8
    SIZE 10
    COLOR 0 0 0
  END
END


#
# NUTS regions at 1 / 3 000 000 
#
LAYER  
	NAME nuts_0
	TYPE POLYGON
	STATUS ON 
	CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" 
    CONNECTION "user=ogam password=ogam dbname=ogam host=localhost port=5433"
    DATA "the_geom FROM nuts_0 USING UNIQUE gid USING srid=3035"
	CLASSITEM "cell_id"
	LABELITEM "cell_id"
	CLASS
	      NAME 'Country'	
	      OUTLINECOLOR 0 0 0      
	      LABEL
				COLOR  255 0 0
				FONT arial_win
				TYPE truetype
				SIZE 8
				POSITION AUTO          
				PARTIALS FALSE
				BUFFER 5
				OUTLINECOLOR 255 255 255           
	     END     
    END
    PROJECTION
		    "init=epsg:3035"
	END
END



#
# Vector layer for plot locations
#
LAYER
    NAME "result_locations"
    TRANSPARENCY 80
    TYPE POINT
    STATUS ON
    METADATA
    	WFS_TITLE		   "Results"
    	GML_FEATUREID      "oid" 
    	GML_INCLUDE_ITEMS  "all"    
    	"gml_groups"        	"display"
		"gml_display_group" 	"provider_id,plot_code" 	 	
  	END
  	DUMP TRUE 
    
    CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" 
    CONNECTION "user=ogam password=ogam dbname=ogam host=localhost port=5433"
    DATA "the_geom FROM (
            SELECT the_geom, provider_id, plot_code, oid FROM result_location
            WHERE GeometryType(the_geom) = 'POINT'
              AND session_id = '%SESSION_ID%'
        ) as foo USING UNIQUE oid USING srid=3035
    "
    
    SYMBOLSCALEDENOM 3000000
    CLASS
      NAME 'Result location'
      STYLE
      	SIZE 12
        COLOR 238 153 0
        OUTLINECOLOR 238 153 0
        SYMBOL "circle"
      END
    END
END 

#
# Vector layer for all locations for all countries
#
LAYER
    NAME "all_locations"
    TRANSPARENCY 80
    TYPE POINT
    STATUS ON
    
    METADATA
    	WFS_TITLE		   "All Plots"
    	GML_FEATUREID      "oid" 
    	GML_INCLUDE_ITEMS  "all"      	
  	END
  	DUMP TRUE 
    
    CONNECTIONTYPE postgis
    PROCESSING "CLOSE_CONNECTION=DEFER" 
    CONNECTION "user=ogam password=ogam dbname=ogam host=localhost port=5433"
    DATA "the_geom FROM (
            SELECT transform(the_geom, 3035) as the_geom, plot_code as oid  
            FROM location
        ) as foo USING srid=3035
    "
    
    SYMBOLSCALEDENOM 3000000
    CLASS
      NAME 'Plot location'
      STYLE
      	SIZE 3
      	MINSIZE 1
		MAXSIZE 5
        COLOR 150 150 150
        OUTLINECOLOR 150 150 150
        SYMBOL "circle"
      END
    END
END 


END # Map File
